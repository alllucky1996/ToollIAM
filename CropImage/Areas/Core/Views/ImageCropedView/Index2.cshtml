@model CropImage.Models.Image
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Core/Views/Shared/_Layout.cshtml";
}

<img src="@ViewBag.Image" alt="Image" id="imageElement"  class="col-md-8" />


<canvas id="faceCanvas"></canvas>

<!-- HTML content has been loaded, run the script now. -->
<script>
            // Get the canvas.
            var canvas = document.getElementById("faceCanvas");
            var img = document.getElementById("imageElement");
    canvas.height = img.height = @ViewBag.H;
            canvas.width = img.width = @ViewBag.W;

            var myCanvas = canvas.getContext("2d");
            myCanvas.drawImage(img, 0, 0);

            @if(true)
            {
            <text>
            img.style.display = "none";
            var facesFound = true;
            var facePositions = JSON.parse(JSON.stringify(@Html.Raw(ViewBag.Positions)));
            </text>
            }

            if(facesFound) {
                // Move forward.
                for (face in facePositions) {
                    // Draw the face.
                    myCanvas.lineWidth = 2;

                  

                    myCanvas.strokeStyle = facePositions[face]["IsOK"] == true ? "#0312c5" : "#FF0000";//facePositions[face]["IsOK"] == true ? "#0312c5" : "#FF0000";//selectColor(face);

                   // console.log(selectColor(face));
                    myCanvas.strokeRect(
                        facePositions[face]["X"],
                        facePositions[face]["Y"],
                        facePositions[face]["Width"],
                        facePositions[face]["Height"]
                        @*@Model.X,
                        @Model.Y,
                        @Model.Width,
                        @Model.Height,*@

                    );
                    myCanvas.font = "14px Arial Sans";
                  
                    myCanvas.strokeText(facePositions[face]["Lable"], facePositions[face]["X"], facePositions[face]["Y"]-3);
                }
            }

            function selectColor(iteration) {
                if (iteration == 0) { iteration = Math.floor(Math.random()); }

                var step = 42.5;
                var randomNumber = Math.floor(Math.random() * 3);

                // Select the colors.
                //var red = Math.floor((step * iteration * Math.floor(Math.random() * 3)) % 255);
                //var green = Math.floor((step * iteration * Math.floor(Math.random() * 3)) % 255);
                //var blue = Math.floor((step * iteration * Math.floor(Math.random() * 3)) % 255);
                var red = 255;
                var green = 0;
                var blue = 0;

                // Change the values of rgb, randomly.
                switch (randomNumber) {
                    case 0: red   = 0; break;
                    case 1: green = 0; break;
                    case 2: blue  = 0; break;
                }

                // Return the string.
                var rgbString = "rgb(" + red + ", " + green + " ," + blue + ")";
                return iteration.IsOK == true ?"#0312c5":"#FF0000";
            }
</script>